{"version":3,"sources":["commands/UsageStats.ts"],"names":[],"mappings":"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","file":"UsageStats.js","sourcesContent":["import { MessageEmbed } from 'discord.js';\nimport { Command, Message } from '@yamdbf/core';\nimport { CommandUsage } from '../CommandUsage';\n\nexport default class extends Command\n{\n\tprivate plugin: CommandUsage;\n\tpublic constructor(plugin: CommandUsage)\n\t{\n\t\tsuper({\n\t\t\tname: 'usagestats',\n\t\t\tdesc: 'Display command usage stats',\n\t\t\tusage: '<prefix>usagestats',\n\t\t\townerOnly: true,\n\t\t\tgroup: 'commandusage'\n\t\t});\n\n\t\tthis.plugin = plugin;\n\t}\n\n\tpublic async action(message: Message, [all]: [string]): Promise<void>\n\t{\n\t\tthis.plugin._incrementCommand(this.name);\n\n\t\tconst oldest: number = this.plugin.sessionUsages[0][1] || Date.now();\n\t\tconst diff: number = Date.now() - oldest < 6e4 ? 6e4 : Date.now() - oldest;\n\t\tconst mins: number = Math.round(diff / 1e3 / 60);\n\t\tconst perMin: number = this.plugin.totalSessionUsed / mins;\n\n\t\tlet topFiveAllTime: [string, number][] = Object.keys(this.plugin.commandsUsed)\n\t\t\t.map(a => <[string, number]> [a, this.plugin.commandsUsed[a]])\n\t\t\t.sort((a, b) => b[1] - a[1]);\n\n\t\tlet topFiveSession: [string, number][] = Object.keys(this.plugin.sessionUsed)\n\t\t\t.map(a => <[string, number]> [a, this.plugin.sessionUsed[a]])\n\t\t\t.sort((a, b) => b[1] - a[1]);\n\n\t\tif (all !== 'all')\n\t\t{\n\t\t\ttopFiveSession = topFiveSession.slice(0, 5);\n\t\t\ttopFiveAllTime = topFiveAllTime.slice(0, 5);\n\t\t}\n\n\t\tconst xl: (str: string) => string = str => `\\`\\`\\`xl\\n${str}\\n\\`\\`\\``;\n\t\tconst embed: MessageEmbed = new MessageEmbed()\n\t\t\t.setAuthor(this.client.user.username, this.client.user.avatarURL())\n\t\t\t.addField('Per minute (session)', xl(perMin.toFixed(2)), true)\n\t\t\t.addField('Total (session)', xl(this.plugin.totalSessionUsed.toString()), true)\n\t\t\t.addField('Total (last hour)', xl(this.plugin.sessionUsages\n\t\t\t\t.filter(u => (Date.now() - u[1]) < (1e3 * 60 * 60)).length.toString()), true)\n\t\t\t.addField(all === 'all' ? 'All time usages' : 'Top five (All time)',\n\t\t\t\txl(topFiveAllTime.map(a => `${a[0]}:\\n${a[1]}`).join('\\n')), true)\n\t\t\t.addField(all === 'all' ? 'Session usages' : 'Top five (session)',\n\t\t\t\txl(topFiveSession.map(a => `${a[0]}:\\n${a[1]}`).join('\\n')), true)\n\t\t\t.addField('Total (all time)', xl(this.plugin.totalUsed.toString()), true)\n\t\t\t.setFooter('Command usage')\n\t\t\t.setTimestamp();\n\n\t\tmessage.channel.send({ embed });\n\t}\n}\n"],"sourceRoot":"../../src"}